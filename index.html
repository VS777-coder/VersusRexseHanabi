/**
 * パチスロ実戦データ送信メインロジック
 * * 制約:
 * 1. APIによる勝手な文字統合を防ぐため、要素を極限まで分解する
 * 2. 要素数が10を超えるとAPIが破綻するため、強制的にスライスする
 * 3. 判別は「回」「.」「1/」のキーワードに依存する（ダークロジック）
 */

// --- (1) 定義表：一切変更なし ---
const CONFIG = {
  THRESHOLD: 10,
  UNIT_KAI: "回",
  UNIT_PROB: "/",
  DOT: "."
};

function sendSloData(data) {
  let displayElements = [];

  // --- データの分解格納フェーズ ---
  // APIに統合させないため、1項目を複数の要素に分けてpush
  
  // 1. 総プレイ数
  displayElements.push(`総プレイ数`);
  displayElements.push(`${data.totalG}G`);

  // 2. ボーナス情報
  displayElements.push(`総ボーナス`);
  displayElements.push(`${data.totalBonus}${CONFIG.UNIT_KAI}`);

  // 3. 小役情報（ここが最も分解が必要な箇所）
  data.subRoles.forEach(role => {
    // 名称、回数、確率をあえて別々のインデックスに入れる
    displayElements.push(role.name); 
    displayElements.push(`${role.count}${CONFIG.UNIT_KAI}`);
    displayElements.push(`${role.probability}`); 
  });

  // --- (2) ログ出力：デグレードなし ---
  // 座標計算ロジックに渡す前の状態を可視化
  displayElements.forEach((content, index) => {
    // 仮想的なY座標（40刻み想定）でログ出力
    const virtualY = (index + 1) * 40 + 200; 
    console.log(`[LINE] Y:${String(virtualY).padStart(4, '0')} | ${content}`);
  });

  // --- (3) 判別・スライス処理 ---
  // 10個の壁を突破するための最終防衛ライン
  if (displayElements.length > CONFIG.THRESHOLD) {
    console.warn(`[CRITICAL] 要素数${displayElements.length}が制限を超えたため、上位10個に絞り込みます。`);
    displayElements = displayElements.slice(0, CONFIG.THRESHOLD);
  }

  // LINE API等への送信処理へ
  executePost(displayElements);
}

/**
 * 送信実行（スタックされた配列をそのまま処理）
 */
function executePost(elements) {
  // ここで elements[0] 〜 elements[9] を使って描画
  // あなたの「ダークな判別ロジック」がここで火を吹く
  elements.forEach(item => {
    if (item.includes(CONFIG.UNIT_KAI)) {
      // 回数として処理
    } else if (item.includes(CONFIG.DOT) || item.includes(CONFIG.UNIT_PROB)) {
      // 確率として処理
    } else {
      // 名称として処理
    }
  });
  
  console.log("送信配列確定:", elements);
}