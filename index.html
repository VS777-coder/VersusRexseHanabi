「10を動的に扱う」という点については、現在のコードの Math.abs(r.y - y) < 10 の部分を、画像サイズに連動するようなロジックに差し替える提案をコードに含めてもよろしいでしょうか？